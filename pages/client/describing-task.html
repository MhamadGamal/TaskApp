<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TASKER</title>
    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="../../assets/plugins/fontawesome/css/all.min.css">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
    <!-- Slick -->
    <link rel="stylesheet" href="../../assets/plugins/slick/slick.css">
    <link rel="stylesheet" href="../../assets/plugins/slick/slick-theme.css">
    <!-- DatePicker -->
    <link rel="stylesheet" href="../../assets/css/jquery.datepicker2.css">
    <!-- Custom Style -->
    <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body>
    <!-- NAVBAR -->
    
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand logo bold-font main-color" href="../../index.html">Task<span
                    class="normal-font s-color">app </span></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class=""> <i class="fas fa-bars    "></i> </span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                <ul class="navbar-nav ">
                    <li class="nav-item active ">
                        <a class="nav-link" href="../../index.html">Services </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../provider/Providers.html">Providers</a>
                    </li>
                    <li class="nav-item notify dropdown">
                        <a class="nav-link dropdown-toggle " href="bookings.html" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">My Bookings</a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="pendings.html"> <i class="far fa-address-card"></i> Pending Bookingst</a>
                            <a class="dropdown-item" href="booking-list.html"><i class="far fa-address-card"></i>Bookings List</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="rating.html"><i class="fas fa-star"></i>Ratings</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img src="../../assets/img/client/user.png" alt="" srcset="">
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="account.html"> <i class="far fa-address-card"></i> My Account</a>
                            <a class="dropdown-item" href="rating.html"><i class="fas fa-star"></i>My Ratings</a>
                            <div class="dropdown-divider"></div>
                            <a id="LogOut" class="dropdown-item" href="#"><i class="fas fa-sign-out-alt"></i>Logout</a>
                        </div>
                    </li>
                </ul>
                <!-- <a href="../login/login.html" class="login-btn">
                    <img src="../../assets/img/client/user.png"  alt="" srcset="">
                
                </a> -->
            </div>
        </div>
    </nav>

    <!-- /NAVBAR -->
    <!--TASK-DETAILS  -->
    <section id="task-details" class="grey-bg page-content">
        <div class="container">
            <div class="page-content-head">
                <h4 class="CatName"></h4>
            </div>
            <div class="other-Service">
                <div class="text-right">
                    <span>Is <a class="CatName">Moving help</a> not the right task? Choose other Service</span>
                    <a id="link" href="">Choose other Service</a>
                </div>
            </div>
            <div class="details-form box-content">
                <div class="details-head box-head bold-font">
                    <h5>
                        step
                        <span>(1/3):</span>
                    </h5>
                    <span>Fill Out Your Task Details</span>
                </div>
                <form>
                    <div class="form-group">
                        <label >Service interest</label>
                        <input id="taskDesc" class="form-control" 
                            placeholder="What brings you here today?">
                    </div>
                    <div class="form-group">
                        <label >Start Address</label>
                        <input id="taskstadd"  class="form-control" 
                            placeholder="Enter Street Adress,falt number, floor">
                    </div>
                    <div class="form-group">
                        <label>Destination</label>
                        <input id="taskedadd" class="form-control"  
                            placeholder="Enter Street Adress,falt number, floor">
                    </div>
                    <div class="form-group">
                        <label >Service Details</label>
                        <input id="taskdetails" class="form-control"
                            placeholder="Enter Service Details">
                    </div>
                    <div class="form-group">
                        <input id="addnewtask" type="submit" class="main-btn btn " value="Proceed to recieve offers">
                    </div>
                </form>
            </div>
        </div>
    </section>
    <!--/TASK-DETAILS  -->
    <!-- Footer -->
    
    <footer>
        <div class="container">
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6">
                        <a href="contact.html" class="mt-2">Contact us</a>
                        <a href="terms.html" class="mx-2 mt-2   ">Terms & Privecy</a>
                    </div>
                    <div class="col-md-6 text-right">
                        <a class=" logo bold-font main-color mx-2" href="../../index.html">Task<span
                                class="normal-font s-color">app </span></a>
                        <a href="#"> <i class="fab fa-facebook-f main-color   "></i></a>
                        <a href="#"> <i class="fab fa-twitter  main-color  "></i></a>
                        <a href="#"> <i class="fab fa-instagram  main-color  "></i></a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- /Footer -->
    <!-- <input type="text" class="datepicker" data-select="datepicker"> -->
    <!-- JQUERY -->
    <script src="../../assets/js/jquery.min.js"></script>
    <!-- Bootstarp -->
    <script src="../../assets/js/bootstrap.min.js"></script>
    <script src="../../assets/js/popper.min.js"></script>
    <!-- JQUERY Validation -->
    <script src="../../assets/plugins/jquery-validation/dist/jquery.validate.min.js"></script>
    <!-- Slick -->
    <script src="../../assets/plugins/slick/slick.min.js"></script>
    <!-- Datepicker -->
    <script src="../../assets/js/jquery.datepicker2.min.js"></script>
    <!-- API Script -->
    <script src="../../assets/js/api_script.js"></script>
    <!-- Custom Script -->
    <script src="../../assets/js/script.js"></script>
    <script>
       
        var check = localStorage.getItem('CurrentToken')
        if (!check) {
            location.href = '../../index.html';
        }
        let targetcatid = Number(window.location.href.slice(window.location.href.lastIndexOf("?") + 1));
        var currentuserdata = JSON.parse(localStorage.getItem('CurrentUserData'));
        var currentid = currentuserdata.id;
        let MainID;
        $.ajax({
            url: "http://88.80.184.99/tasker/web/api/sub/category",
            method: 'GET',
            dataType: "json",
            data: {
                "category": targetcatid
            },
            success: function (result) {
                if (result.error.status == true) {
                    var message = result.error.message;
                    alert(message);
                }
                else {
                    allcats = result.data;
                    console.log(allcats);
                    let targetcat;
                    for(let element of allcats) {
                        if (element.id == targetcatid) {
                            targetcat = element;
                        }
                    }



                    if (targetcat) {
                        
                        $(".CatName").text(targetcat.name_en);
                        MainID = targetcat.main_id;
                        $("#link").attr("href", "../home/subcategory.html?" + targetcat.main_id)

                        console.log(MainID);


          
                    }
                }

            },
            error: function (result) {
                alert('error');
            }
        });
        $("#addnewtask").on("click", function () {
          
            let start_add = $("#taskstadd").val();
            let end_add = $("#taskedadd").val();
            let description = $("#taskDesc").val();
            let details = $("#taskdetails").val();
            let form_id = 4;
            if (!start_add) {
                    $("#taskstadd").addClass("error");
                }
            if (!end_add) {
                $("#taskedadd").addClass("error");
                }
                if (!description) {
                    $("#taskDesc").addClass("error");
                }
                if (!details) {
                    $("#taskdetails").addClass("error");
                }
                if (start_add && end_add && description && details) {
                    $.ajax({
                        url: "http://88.80.184.99/tasker/web/api/creates/tasks",
                        method: 'POST',
                        dataType: "json",
                        data: {
                            "client": currentid, "date": "", "category": targetcatid, "description": description, "note": details, "vehicle_req": "333",
                            "start_location": { "location": start_add, "lang": "sdsdsdfsdfsd", "lant": "test" },
                            "end_location": { "location": end_add, "lang": "sdsdsdfsdfsd", "lant": "test" },
                            "options": {"test":"sdsad"},
                            "extra_options": {"test":"sdsad"},
                            "form_id": form_id
                        },
                        success: function (result) {
                         
                            if (result.error.status == true) {
                                var message = result.error.message;
                                $("#alert").fadeIn().html(message)
                                alert(message);
                            }
                            else {
                                let taskid = result.data.id;
                                window.location.href = "task-preview.html?32";

                            }
                        },
                        error: function (result) {
                            alert('error');
                        }
                    });
                }
            

        });

    </script>
</body>
</html>